<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDReXCjVK3a0mchWsSvUHXzUGl2H-rCqn8&libraries=places,geometry"></script>

<p>Your Location loads automatically.</p>

<p id="demo"> Here they are!</p>

<!-- LYFT BUTTON GOES HERE -->
<div id="lyft-web-button-parent"></div>

<script>
window.onload= getLocation();

var x = document.getElementById("demo");

var latx = "";
var longy = "";

function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
    } else {
        x.innerHTML = "Geolocation is not supported by this browser.";
    }
}
function showPosition(position) {
    x.innerHTML = "Latitude: " + position.coords.latitude + 
    "<br>Longitude: " + position.coords.longitude; 
    latx = position.coords.latitude;
    longy = position.coords.longitude;
    
}
</script>

<button onclick="initMap(latx, longy);">Click here to browse restaurants</button>

<div id="map" style="display:none;"></div>
<div id="res"></div>


<script>

// Setting the user location    


// Grabbing the results from the User location
var map;
var service;

function initMap(param_lat, param_lng, cat_search) {

  var pyrmont = new google.maps.LatLng(param_lat, param_lng);

  map = new google.maps.Map(document.getElementById('map'), {
    center: pyrmont,
    zoom: 15
  });

  var request = {
    location: pyrmont,
    radius: 5000,
    type: ['food'],
    maxPriceLevel: ["2"],
    rankBy: [google.maps.places.RankBy.PROMINENCE]
  };


  service = new google.maps.places.PlacesService(map);
  service.nearbySearch(request, callback);

  function callback(results, status) {
    if (status == google.maps.places.PlacesServiceStatus.OK) {
      var resultCount = 0;
      for (var i = 0; i < results.length; i++) {
        if (google.maps.geometry.spherical.computeDistanceBetween(results[i].geometry.location, pyrmont) < request.radius) {
          console.log(results[i]);
          $("#res").prepend(results[i]);
          var request2 = {
            placeId: results[i].place_id
          };
          
          service = new google.maps.places.PlacesService(map);
          resultCount++;
        }
      }
      if (resultCount == 0) {
        $("#res").prepend("No Results inside search area");
      }
    } else {
      $("#res").prepend("No Results, status " + status);
    }
  }
}


function toRad(Value) { // Converts numeric degrees to radians
  return Value * Math.PI / 180;
}
</script>

<!-- // Calling the lyft API for price suggestion to destination.  -->
<script type="text/javascript">
  var OPTIONS = {
    scriptSrc: 'lyftWebButton.js',
    namespace: '',
    clientId: 'dVADcs_RXdec',
    clientToken: 'WA1svvInRfqditf+7XAyrpObsEx/s3m5u4+hPPERfGCte06OHtmTPqIHb6hgNhsWl1agE41cnUl+i1Brpf9D2Uh8NsDSy49xf1OC5Q7Gwy5z15d9I2KQD14=',
    location: {
      pickup: {}, 
      destination: {
        latitude: '37.776503000',
        longitude: '-122.392038500',
      },
    },
    parentElement: document.getElementById('lyft-web-button-parent'),
    queryParams: {
      credits: ''
    },
    theme: 'multicolor large',
  };
  (function(t) {
    var n = this.window,
    e = this.document;
    n.lyftInstanceIndex = n.lyftInstanceIndex || 0;
    var a = t.parentElement,
    c = e.createElement("script");
    c.async = !0, c.onload = function() {
    n.lyftInstanceIndex++;
    var e = t.namespace ? "lyftWebButton" + t.namespace + n.lyftInstanceIndex : "lyftWebButton" + n.lyftInstanceIndex;
    n[e] = n.lyftWebButton, t.objectName = e, n[e].initialize(t)
  }, c.src = t.scriptSrc, a.insertBefore(c, a.childNodes[0])
  }).call(this, OPTIONS);

</script>